String.prototype.hashCode=function(){var hash=0,i,chr;if(this.length===0)return hash;for(i=0;i<this.length;i++){chr=this.charCodeAt(i);hash=((hash<<5)-hash)+chr;hash|=0}
return hash};Date.prototype.addDays=function(days){var dat=new Date(this.valueOf());dat.setDate(dat.getDate()+days);return dat};(function(){var days=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];var months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sept','Oct','Nov','Dec'];Date.prototype.getMonthName=function(){return months[this.getMonth()]};Date.prototype.getDayName=function(){return days[this.getDay()]}})();function getRootPath(){return $("#global-paths").data("rootpath")}
function addShippingHeaderRow(container,title){var header=$('<h1>').text(title);container.append(header)}
function addShippingEntryRow(container,entryTitle,entry,prefix){if(entry['prefix']!==undefined&&entry['prefix']!==prefix)
return;var id=prefix+entry['id'];var requiredText=entry.required?" *":"";var $row=$('<div>',{class:"form-group"}).append($('<label>',{for:id}).text(entryTitle+requiredText));var $input=null;if(entry['src']!==undefined){$input=$('<select>',{id:id,class:"form-control",name:id});var values=eval(entry['src']);if(values!==undefined){for(var i in values){var $option=$('<option>',{value:i}).text(values[i]);$input.append($option)}}}else{$input=$('<input>',{id:id,class:"form-control",name:id,type:"text",maxlength:entry['maxLength']})}
if(entry['required']){$input.attr('required',!0)}
if(entry['pattern']){$input.attr('pattern',entry['pattern']);$input.attr('oninvalid',"setCustomValidity('"+entry['message']+"')");$input.attr('onchange',"try{setCustomValidity('')}catch(e){}")}
$row.append($input);if(entry['comment']!==undefined){var $comment=$('<span>',{class:"info"}).text(entry['comment']);$row.append($comment)}
container.append($row)}
function showAddress(containerId,title,prefix){var $container=$("#"+containerId);var requiredTip=$("#checkout_form").data("required-tip");if($container!==null){addShippingHeaderRow($container,title);for(var i in addressTable){addShippingEntryRow($container,i,addressTable[i],prefix)}
$container.append($("<div>").text(requiredTip))}}
function initToggleBillingListener(){var $trigger=$('#same-billing-trigger');var $shippingAddressContainer=$('#shipping_address');var shippingAddress=getShippingAddress();function hideShipping(){$shippingAddressContainer.fadeOut().promise().done(function(){$trigger.css('margin-bottom','30px')});$shippingAddressContainer.find(":input").prop("disabled",!0)}
function showShipping(){$trigger.css('margin-bottom','0px');$shippingAddressContainer.find(":input").prop("disabled",!1);$shippingAddressContainer.fadeIn()}
var $sameBilling=$("#same_billing");$sameBilling.on('change',function(){var $this=$(this);if($this.is(':checked')){hideShipping()}else{showShipping()}});$sameBilling.attr("checked",!0).trigger("change")}
function getCart(){var serializedCart=localStorage.getItem('cart');if(serializedCart!==null&&serializedCart.length>0){return JSON.parse(serializedCart)}else{return createNewCart()}}
function createNewCart(){var cart={currency_code:"USD",items:[]};updateCart(cart);return cart}
function updateCart(cart){if(isCartEmpty(cart)||!isCartContainsDiscountedItems(cart)){cart=dropCoupon(cart)}
localStorage.setItem('cart',JSON.stringify(cart))}
function isCartEmpty(cart){return cart.items.length===0}
function updateAndRefreshCart(cart){updateCart(cart);refreshCart()}
function setImage(item,colsm){return $('<div>',{class:"col-sm-%COL% col-xs-4 cart_product_img".replace(/%COL%/,colsm)}).append($('<div>',{class:"cart-item-img"}).append($('<a>',{href:item.ref}).append($('<img>',{src:item.img,alt:''})))).append($('<div>',{class:"cart-item-sku"}).text("SKU: "+item.number))}
function setItemDescription(item,colsm){var $description=$('<div>',{class:"col-sm-%COL% col-xs-8 cart_desc m-10".replace(/%COL%/,colsm)}).append($('<a>',{href:item.ref,class:"cart-item-url"}).text(item.name));if(item.options.length>0){var options=item.options.map(function(currentValue){return currentValue.value});$description.append($('<span>',{class:"options"}).text(options.join(", ")))}
if(item.hasOwnProperty("backorder")&&item.backorder.length>0){$description.append($('<span>').text("Not in stock, ship on "+item.backorder))}
return $description}
function setItemQuantityOptions(n,selectedValue){var options=$();selectedValue=parseInt(selectedValue);for(var i=1;i<=n;i++){var selected=selectedValue===i;options=options.add($('<option>',{val:i,selected:selected}).text(i))}
return options}
function setItemQuantity(item){var $select=$('<select>',{name:'quantity'}).append(setItemQuantityOptions(10,item.quantity));$select.on("change",function(){updateItemValue(item.id,"quantity",$(this).val())});return $('<div>',{class:"col-sm-2 col-xxs-offset-4 cart_qty text-right-res2 m-10"}).append($select)}
function getRemarkStar(){return $("<span>",{class:"cart-sale-star js-sale-star"}).text("*").prop('outerHTML')}
function getOldAmount(item){if(isItemOnSale(item)){return $("<span>",{class:"cart-old_amount"}).text("$"+(parseFloat(item.old_amount)*parseInt(item.quantity)).toFixed(2)).prop("outerHTML")+"<br/>"}else{return""}}
function isItemOnSale(item){return item.on_sale==="true"}
function isItemForcedCoupon(item){return item.forced_coupon}
function isItemBackordered(item){return(item.backorder.trim().length>0)}
function isCartContainsBackorderedItems(cart){for(var i=0;i<cart.items.length;i++){if(isItemBackordered(cart.items[i])){return!0}}
return!1}
function isCartContainsDiscountedItems(cart){for(var i=0;i<cart.items.length;i++){if(cart.items[i].hasOwnProperty("discount")&&cart.items[i].discount>0){return!0}}
return!1}
function getItemAmountAndDiscount(item){var $amountContainer=$("<div>",{class:"amount-container"});var discount=getItemDiscount(item);var amount=parseFloat(item.amount)*parseInt(item.quantity);if(discount>0){$amountContainer.html(getOldAmount(item)+"$"+amount.toFixed(2)+"<br/>"+"-$"+discount.toFixed(2))}else{var remark="";if(isItemOnSale(item)){remark=getRemarkStar()}
$amountContainer.html(getOldAmount(item)+"$"+amount.toFixed(2)+remark)}
return $amountContainer}
function setItemAmount(item){var $amountContainer=getItemAmountAndDiscount(item);var $amount=$('<div>',{class:"col-sm-3 col-xxs-offset-4 cart_amount text-right-res2 m-10"}).append($amountContainer);var $button=$('<button>',{class:"btn js-remove-cart-item",type:"button"});$button.text('Remove');$button.prepend($('<i>',{class:"fa fa-close"}));$button.on('click',function(){var $cartItem=$(this).closest(".js-cart-item");var id=$cartItem.data("item-id");removeItemFromCart(id)});$amount.append($button);return $amount}
function getItemDiscount(item){if(item.discount){return parseFloat(item.discount)*parseInt(item.quantity)}
return 0.0}
function initCouponSection(cart,discountedItemsCount,itemsCount,itemsOnSaleCount){var $couponContainer=$("#cart-coupon-container");$couponContainer.html("");var $couponRemark=$("#cart-coupon-remark");$couponRemark.html("");if(cart.coupon!==undefined){if(discountedItemsCount>0&&discountedItemsCount!==itemsCount){var $button=$('<button>',{class:"btn coupon-remove-btn",type:"button"});$button.text('Remove coupon');$button.prepend($('<i>',{class:"fa fa-close"}));$button.on('click',function(){updateCart(dropCoupon(cart));refreshCart()});$couponContainer.append($("<span>",{class:"cart-coupon"}).text("Coupon "+cart.coupon.toUpperCase()+" applied to your order")).append($button)}}
var remark="";if(cart.couponRemark){remark=cart.couponRemark;delete cart.couponRemark;updateCart(cart)}else if(itemsOnSaleCount>0&&cart.coupon){remark="Coupon is not applicable to the products that are on sale or special preorder."}
if(remark.length>0){$couponRemark.append($("<span>",{class:"cart-coupon-remark"}).html(getRemarkStar()+" "+remark));$(".js-sale-star").css("display","inline")}}
function initPayPalCreditText(totalAmount){var payPalCreditWrapper=$("#paypal-credit-wrapper");var creditText=payPalCreditWrapper.data("text");var creditMinAmount=parseFloat(payPalCreditWrapper.data("min-amount"));(totalAmount>creditMinAmount)?payPalCreditWrapper.show():payPalCreditWrapper.hide();$("#paypal-credit-text").text(creditText+(totalAmount/6).toFixed(2)+"/Month")}
function initEstimatedShippingSection(cart){var defaultCountry=$("#default_shipping_country").text().trim();var shippingOptions=getShippingOptions(cart,defaultCountry);var defaultOption=shippingOptions[0];var shippingCost=(defaultOption.amount>0)?"$"+defaultOption.amount:"FREE";var shippingDate=formatDate(getShippingDateRange(defaultOption).dateRange.to,"short");$("#shipping_amount").text(shippingCost);$("#ship-date").text(shippingDate)}
function renderCart(cart){var items=cart.items;var $container=$("#cart-container");var itemsCount=0;var discountedItemsCount=0;var itemsOnSaleCount=0;$container.html('');if(items.length===0){$container.append($('<div>',{class:"empty-cart"}).text("Cart is empty!"))}
items.forEach(function(item){itemsCount++;if(item.discount>0){discountedItemsCount++}
if(isItemOnSale(item)){itemsOnSaleCount++}
var $item=$('<div>',{class:"border-bottom js-cart-item",'data-item-id':item.id});var $image=setImage(item,3);var $description=setItemDescription(item,4);var $quantity=setItemQuantity(item);var $amount=setItemAmount(item);$item.append($image);$item.append($description);$item.append($quantity);$item.append($amount);$item.append($('<div>',{class:"clearfix"}));$container.append($item)});var totalAmount=calculateCartTotalAmount(items);$("#total_amount").text("$"+totalAmount.toFixed(2));initPayPalCreditText(totalAmount);initCouponSection(cart,discountedItemsCount,itemsCount,itemsOnSaleCount);initEstimatedShippingSection(cart)}
function refreshCartCoupon(coupon){updateCartCoupon(coupon).always(function(){refreshCart()})}
function refreshCart(){var cart=getCart();renderCart(cart);updateCartIndicator()}
function reduceFormData(formData,regex,replace){if(replace===undefined){replace=""}
var formatted={};for(var itemName in formData){if(formData.hasOwnProperty(itemName)){if(regex.test(itemName)){var name=itemName.replace(regex,replace);formatted[name]=formData[itemName]}}}
return formatted}
function clearShippingAndPayment(){var cart=getCart();delete cart.shipping;updateCart(cart);localStorage.removeItem("card")}
function initCheckoutContinueListener(){$("#checkout_form").on("submit",function(e){var $this=$(this);if($this[0].checkValidity()){e.preventDefault();var serializedForm=$this.serialize();if($("#same_billing").is(":checked")){serializedForm+="&"+serializedForm.replace(/b_/g,"s_")}
setSerializedAddressData(serializedForm);sendAddressToServer();clearShippingAndPayment();window.location.href="shipping-options.html"}})}
function setShippingAddress(shipping){localStorage.setItem("shipping",JSON.stringify(shipping))}
function getShippingAddress(){return JSON.parse(localStorage.getItem("shipping"))}
function setBillingAddress(billing){localStorage.setItem("billing",JSON.stringify(billing))}
function setRawAddress(address){localStorage.setItem("address",address)}
function getRawAddress(){return localStorage.getItem("address")}
function getBillingAddress(){return JSON.parse(localStorage.getItem("billing"))}
function setChatIcon(){$(".wrap_shipping").prepend($("<div>",{class:"cart-chat"}).html("<div id=\"ciF30I\" style=\"z-index:100;position:absolute\"></div>\n"+"  <div id=\"scF30I\" style=\"display:inline\"></div>\n"+"  <div id=\"sdF30I\" style=\"display:none\"></div>\n"+"  <script type=\"text/javascript\">\n"+"     var seF30I=document.createElement(\"script\");\n"+"     seF30I.type=\"text/javascript\";\n"+"     var seF30Is=(location.protocol.indexOf(\"https\")===0?\"https\":\"http\")+\"://image.providesupport.com/js/gromaudio/safe-standard.js?ps_h=F30I&amp;ps_t=\"+new Date().getTime();\n"+"     setTimeout(\"seF30I.src=seF30Is;document.getElementById('sdF30I').appendChild(seF30I)\",1)\n"+"  </script>\n"+"  <noscript>\n"+"    <div style=\"display:inline\">\n"+"      <a href=\"https://www.providesupport.com?messenger=gromaudio\">\n"+"       <img src=\"https://image.providesupport.com/image/gromaudio/current\" border=\"0\"/>\n"+"      </a>\n"+"    </div>\n"+"  </noscript>"))}
function restoreSavedAddresses(){var address=getRawAddress();if(address!==undefined){$.each(address.split('&'),function(index,elem){var values=elem.split('=');$("[name='"+values[0]+"']").val(decodeURIComponent(values[1]).replace(/\+/g,' '))})}}
function rawAddressToArrayObject(address){var addressData={};$.each(address.split('&'),function(index,elem){var values=elem.split('=');addressData[values[0]]=decodeURIComponent(values[1]).replace(/\+/g,' ')});return addressData}
function setAddressData(addressData){var billing=reduceFormData(addressData,/^b_/);var shipping=(addressData.hasOwnProperty("same_billing"))?billing:reduceFormData(addressData,/^s_/);setBillingAddress(billing);setShippingAddress(shipping)}
function setSerializedAddressData(address){var addressData=rawAddressToArrayObject(address);setRawAddress(address);setAddressData(addressData,address)}
function initCheckoutPage(){if($('#checkout_form').length>0){showAddress('billing_address','Enter your Billing address','b_');showAddress('shipping_address','Enter your Shipping address','s_');initToggleBillingListener();initCheckoutContinueListener();setChatIcon();restoreSavedAddresses()}}
function payWithPaypal(){var cart=getCart();var shipping=getShippingAddress();postCart(cart).done(function(id){setSessionOption("","");submitPaypalForm(id,cart,shipping)})}
function setPaypalListener(){$("#paypal-checkout").on("click",function(e){e.preventDefault();payWithPaypal()})}
function renderAmazonButton(size){size=size?size:"x-large";var authRequest;OffAmazonPayments.Button("AmazonPayButton","A30AAU8MWXVBP1",{type:"PwA",color:"DarkGray",size:size,authorization:function(){var loginOptions={scope:"payments:shipping_address payments:widget",popup:"true"};authRequest=amazon.Login.authorize(loginOptions,"amazon-confirmation.html")},onError:function(error){alert(error)}})}
function setAmazonLogin(){amazon.Login.setClientId('amzn1.application-oa2-client.20566427e38c4b25a05c201ebf676ca2');if(sandboxMode){amazon.Login.setSandboxMode(!0)}}
function postCart(cart){var deferred=$.Deferred();var data={cmd:"add_cart",cart:cart};$.post(getRootPath()+"/cart/cart.php",data).done(function(id){id=id.trim();var cart=getCart();cart.orderID=id;updateCart(cart);deferred.resolve(id)}).fail(function(e){deferred.reject(e)});return deferred.promise()}
function getTaxRate(state){var tax=TAX_RATES[state];return(tax===undefined)?0.0:tax}
function getActualTax(shippingData,subtotal,cart){var tax=0;if(shippingData!==null){var addressState=shippingData.address_state.toLowerCase();if(shippingData.address_country.toLowerCase()==='us')
tax=Math.round((subtotal+parseFloat(cart.shipping.amount))*100*getTaxRate(addressState))/100;else tax=Math.round(subtotal*100*getTaxRate(addressState))/100}
return tax||0}
function placeOrder(){var cart=getCart();var shipping=getShippingAddress();var amountDiscount=calculateAmountAndDiscount(cart.items);var subtotal=amountDiscount.amount-amountDiscount.discount;var tax=getActualTax(shipping,subtotal,cart);var data={cmd:"place_order",address:getRawAddress(),card:$.param(getCard()),subtotal:subtotal,tax:tax,shipping:cart.shipping.amount,carrier:cart.shipping.name};$.post(getRootPath()+"/cart/cart.php",data).done(function(result){if(result.trim()==="OK"){confirmPayment(cart);window.location.href="thankyou.html"}else{alert(result)}})}
function dropCoupon(cart){delete cart.coupon;for(var i=0;i<cart.items.length;i++){delete cart.items[i].discount}
return cart}
function addCouponDiscount(cart,coupons){var discountedCount=0;cart.items.forEach(function(cartItem,index){coupons.forEach(function(couponItem){if(couponItem.prd_sku_cd===cartItem.number){if(isItemOnSale(cartItem)){delete cart.items[index].discount}else{cart.items[index].discount=parseFloat(couponItem.cpn_amt);discountedCount++}}})});return discountedCount}
function sendCouponToServer(coupon){$.post(getRootPath()+"/cart/cart.php?set_coupon",{coupon:coupon})}
function addCoupon(cart,coupons,coupon){cart=dropCoupon(cart);if(addCouponDiscount(cart,coupons)>0){cart.coupon=coupon;sendCouponToServer(coupon)}else{cart.couponRemark="Coupon "+coupon.toUpperCase()+" is not applicable to the items in shopping cart. Not applicable to discounted or preorder prices."}
return cart}
function getCartSKUs(cart){var SKUs=[];cart.items.forEach(function(cartItem){if(SKUs.indexOf(cartItem.number)===-1){SKUs.push(cartItem.number)}});return SKUs}
function getPaymentStatus(sessionID){var deferred=$.Deferred();var data={"session":sessionID};$.get(getRootPath()+"/cart/cart.php?get_payment_status",data).done(function(status){deferred.resolve(status.trim())}).fail(function(){deferred.reject()});return deferred}
function getSessionAddress(){var deferred=$.Deferred();var orderId={"orderId":getCart().orderID};if(orderId!==undefined){$.get(getRootPath()+"/cart/cart.php?get_address",orderId).done(function(data){try{deferred.resolve(JSON.parse(data))}catch(e){deferred.reject()}}).fail(function(){deferred.reject()})}else{deferred.reject()}
return deferred.promise()}
function clearSessionIfPaymentComplete(cart){if($("#thank_page").length===0){var deferred=$.Deferred();if(cart.hasOwnProperty("orderID")){getPaymentStatus(cart.orderID).done(function(status){if(status==="P"||status==="C"||status==="D"){reportReferrer(cart.orderID).done(function(){clearSessionData();location.reload()})}}).always(function(){deferred.resolve()})}else{deferred.resolve()}
return deferred}}
function reportReferrer(orderID){var deferred=$.Deferred();$.get(getRootPath()+"/cart/cart.php?report_referrer",{order_id:orderID}).always(function(){deferred.resolve()});return deferred}
function updateCartCouponDiscount(coupon,cart,data){var deferred=$.Deferred();$.get(getRootPath()+"/cart/cart.php?get_coupon",data).done(function(data){var data=JSON.parse(data);var result=!0;if(data.error){cart.couponRemark=data.error}else if(data.length>0){cart=addCoupon(cart,data,coupon)}else{cart.couponRemark="Coupon "+coupon.toUpperCase()+" is not applicable to the items in shopping cart."}
updateCart(cart);deferred.resolve(result)});return deferred.promise()}
function updateCartCoupon(coupon){var deferred=$.Deferred();if(coupon!==undefined){var cart=getCart();var SKUs=getCartSKUs(cart);var data={coupon:coupon,SKU:SKUs};updateCartCouponDiscount(coupon,cart,data).done(function(){deferred.resolve()}).fail(function(){deferred.reject()})}else{deferred.reject()}
return deferred.promise()}
function setCouponListener(){$("#coupon-button").on("click",function(){var coupon=$("#coupon").val();refreshCartCoupon(coupon)})}
function setLeavePageListener(){var start=new Date();$(window).on('beforeunload',function(){var end=new Date();var page=window.location.href;var seconds=Math.floor((end.getTime()-start.getTime())/1000);var data={last_page:page,seconds:seconds};sendLastPageToServer(data)})}
function initShippingEstimator(){var $countrySelector=$("#shipping-estimator");$countrySelector.html('');for(var i in COUNTRIES){if(COUNTRIES.hasOwnProperty(i)){var $option=$("<option>").attr("value",i).text(COUNTRIES[i])
$countrySelector.append($option)}}
$("#shipping-estimator-button").on("click",function(e){e.preventDefault();var $target=$(e.target);var titleText=$target.data("popup-title");var selectedCountry=$countrySelector.val();if(selectedCountry.trim().length===0){return alert($target.data("not-selected"))}
var options=getShippingOptions(getCart(),selectedCountry);var dialogObject=$("<div>",{class:"cart-notification-object"});var title=$("<div>",{class:"col-md-12 cart-notification-title"}).text(titleText);dialogObject.append(title);var itemsContainer=$("<div>",{id:"cart-notification-items"});options.forEach(function(option){option.amount=option.amount===-1?0:option.amount;var shippingAmountString=" ("+getShippingAmountString(option.amount)+")";var deliveryTime=formShippingTimeString(option);var itemContainer=$("<div>",{class:"border-bottom cart-notification-item popup-shipping-item"});var $description=$('<div>',{class:""}).append($('<div>',{class:"popup-shipping-name"}).text(option.name+shippingAmountString)).append($('<span>',{class:"popup-shipping-date"}).text(deliveryTime));itemContainer.append($description);itemsContainer.append(itemContainer)});dialogObject.append(itemsContainer);var continueShopping=$("<div>",{class:"cart-notification-button cart-notification-continue",style:"float:right;margin-right:15px;"}).text("OK").on("click",function(){dialogObject.dialog("close")});dialogObject.append(continueShopping);dialogObject.dialog({draggable:!1,resizable:!1,modal:!0,closeOnEscape:!0,open:function(event,ui){$('.ui-widget-overlay').bind('click',function(){dialogObject.dialog('close')})}});$(".ui-dialog-titlebar").hide()})}
function initShoppingCart(){if($('#shopping_cart').length>0){refreshCart();setPaypalListener();setAmazonLogin();renderAmazonButton();setCouponListener();initShippingEstimator()}}
function submitPaypalForm(id,cart,shipping){var paypalUrl="https://www.paypal.com/cgi-bin/webscr";if(sandboxMode){paypalUrl="https://www.sandbox.paypal.com/cgi-bin/webscr"}
var items=cart.items;var $paypalContainer=$("#paypal-form");$paypalContainer.html('');var $form=$('<form>',{action:paypalUrl,method:"post"});items.forEach(function(item,i){var index=i+1;var $number=$('<input>',{name:"item_number_"+index,value:item.number});$form.append($number);var $name=$('<input>',{name:"item_name_"+index,value:item.name});$form.append($name);item.options.forEach(function(option,optionIndex){var $optionName=$('<input>',{name:"on"+optionIndex+"_"+index,value:option.name});var $optionValue=$('<input>',{name:"os"+optionIndex+"_"+index,value:option.value});$form.append($optionName);$form.append($optionValue)});var $quantity=$('<input>',{name:"quantity_"+index,value:item.quantity});$form.append($quantity);var $amount=$('<input>',{name:"amount_"+index,value:item.amount});$form.append($amount);var discount=getItemDiscount(item);var $discount=$("<input>",{name:"discount_amount_"+index,value:discount});$form.append($discount)});if(shipping){$form.append($("<input>",{name:"address1",value:shipping.address_street}));$form.append($("<input>",{name:"address2",value:shipping.address_street2}));$form.append($("<input>",{name:"city",value:shipping.address_city}));$form.append($("<input>",{name:"country",value:shipping.address_country}));$form.append($("<input>",{name:"email",value:shipping.payer_email}));$form.append($("<input>",{name:"first_name",value:shipping.first_name}));$form.append($("<input>",{name:"last_name",value:shipping.last_name}));$form.append($("<input>",{name:"state",value:shipping.address_state}));$form.append($("<input>",{name:"zip",value:shipping.address_zip}))}
var url=window.location.href;var str=url.substr(url.lastIndexOf('/')+1)+'$';url=url.replace(new RegExp(str),'');$form.append($('<input>',{name:"return",value:url+"thankyou_pp.html?payment=success"}));$form.append($('<input>',{name:"upload",value:"1"}));$form.append($('<input>',{name:"cmd",value:"_cart"}));$form.append($('<input>',{name:"business",value:"sales@gromaudio.com"}));$form.append($('<input>',{name:"page_style",value:"GROMAudio"}));$form.append($('<input>',{name:"invoice",value:id}));$form.append($('<input>',{name:"custom",value:id}));$paypalContainer.append($form);$form.submit()}
function getNumberOfCartItems(){var cart=getCart();return cart.items.length}
function updateCartIndicator(){$(".cart-indicator").text(getNumberOfCartItems())}
function generateItemId(item){return(item.number+JSON.stringify(item.options)).hashCode()}
function getItemFromPage(){var item={name:$("#item-name").val(),number:$("#item-number").val(),amount:$("#item-amount").val(),quantity:1,img:$(".js-item-img")[0].src,ref:$("#ref").val(),on_sale:$("#on_sale").val(),backorder:$("#backorder").val(),forced_coupon:!!$("#forced_coupon").val(),options:[]};if(isItemOnSale(item)){item.old_amount=$("#item-old_amount").val()}
var $option=$("#os0");item.options.push({name:$("#on0").val(),value:$option.length===0?"":$option.val().trim()});item.id=generateItemId(item);return item}
function getRelatedItemData($relatedItem){var item={name:$relatedItem.find(".js-related-name").val(),number:$relatedItem.find(".js-related-number").val(),amount:$relatedItem.find(".js-related-amount").val(),quantity:1,img:$relatedItem.find(".js-related-img").val(),ref:$relatedItem.find(".js-related-ref").val(),on_sale:$relatedItem.find(".js-related-on_sale").val(),backorder:$relatedItem.find(".js-related-backorder").val(),forced_coupon:!!$relatedItem.find(".js-related-forced_coupon").val(),options:[]};if(isItemOnSale(item)){item.old_amount=$relatedItem.find(".js-related-old_amount").val()}
item.id=generateItemId(item);return item}
function getRelatedItemsFromPage(){var items=[];$(".js-related-checkbox:checked").each(function(){var $relatedItem=$(this).closest(".js-related-item");var item=getRelatedItemData($relatedItem);items.push(item)});return items}
function sendItemToServer(item){item={item:item};$.post(getRootPath()+"/cart/cart.php?add_single_item",item).done(function(id){id=id.trim();var cart=getCart();cart.orderID=id;updateCart(cart)})}
function sendLastPageToServer(data){$.post(getRootPath()+"/cart/cart.php?set_last_page",data)}
function sendAddressToServer(){var data={address:getRawAddress()};$.post(getRootPath()+"/cart/cart.php?set_address",data)}
function addItemToCart(item){var cart=getCart();var isUpdated=!1;cart.items.forEach(function(cartItem,i){if(item.id===cartItem.id){item.quantity=cart.items[i].quantity+1;cart.items[i]=item;isUpdated=!0}});if(!isUpdated){cart.items.push(item)}
sendItemToServer(item);updateCart(cart);updateCartCoupon(cart.coupon)}
function updateItemValue(id,name,value){var cart=getCart();var changedItem=null;cart.items.forEach(function(cartItem,i){if(id===cartItem.id){cart.items[i][name]=value;changedItem=cart.items[i]}});if(changedItem!==null){sendItemToServer(changedItem)}
updateAndRefreshCart(cart)}
function removeItemFromCart(id){var cart=getCart();var removedItem=null;cart.items=cart.items.filter(function(item){if(item.id===id){removedItem=item;removedItem.quantity=0;sendItemToServer(removedItem)}
return item.id!==id});updateAndRefreshCart(cart)}
function formValidated(){var $option=$("#os0");if($option.length===0){return!0}
return $option.val().trim().length!==0}
function getNotCheckedRecommendedItems(){var recommended=[];$(".js-related-recommended").each(function(){var $this=$(this);if($this.val().length>0&&$this.val().toUpperCase()==="yes".toUpperCase()){var $relatedItem=$(this).closest(".js-related-item");if(!$relatedItem.find(".js-related-checkbox").is(":checked")){recommended.push(getRelatedItemData($relatedItem))}}});return recommended}
function addRecommendedHandler(item,message){addItemToCart(item);var $this=$(this);$this.addClass("cart-notification-add__success");$this.text(message);$this.off()}
function initAddRecommendedToCartButton(item,info,data){var button=$("<div>",{class:"cart-notification-button cart-notification-continue cart-notification-add"}).text(data.add_to_cart_button).on("click",function(){addRecommendedHandler.call(this,item,data.added_product_text)});info.append(button)}
function getDataAttributes(selector){return unbindData($(selector).data())}
function unbindData(data){var tData={};for(var k in data)tData[k]=data[k];return tData}
function getNotificationData(recommendedItems,addedItems){var data;if(recommendedItems.length===0){data=getDataAttributes("#standard-cart-notification");data.reminder=!1}else{data=getDataAttributes("#reminder-cart-notification");data.title=addedItems.map(function(t){return t.number}).join(", ")+" "+data.title;data.reminder=!0}
if(data.subtitle.length>0){data.subtitle=$("<div>",{class:"col-md-12 cart-notification-subtitle"}).text(data.subtitle)}
return data}
function showNotification(items){var recommendedItems=getNotCheckedRecommendedItems();var data=getNotificationData(recommendedItems,items);if(data.reminder){items=recommendedItems}
var dialogObject=$("<div>",{class:"cart-notification-object"});var title=$("<div>",{class:"col-md-12 cart-notification-title"}).text(data.title);dialogObject.append(title);dialogObject.append(data.subtitle);var itemsContainer=$("<div>",{id:"cart-notification-items"});items.forEach(function(item){var itemContainer=$("<div>",{class:"border-bottom cart-notification-item"});var image=$("<div>",{class:"col-md-4"}).append($("<img>",{class:"cart-notification-image",title:"Item Image",src:item.img}));var info=$("<div>",{class:"col-md-8 cart-notification-info"});var name=$("<div>",{class:"cart-notification-item_name"}).text(item.name);var number=$("<div>",{class:"cart-notification-item_number"}).text(item.number);var price=$("<div>",{class:"d-inline-block"}).text("$"+item.amount);info.append(name).append(number).append(price);if(data.reminder){initAddRecommendedToCartButton(item,info,data)}
itemContainer.append(image).append(info).append($("<div>",{class:"clearfix"}));itemsContainer.append(itemContainer)});dialogObject.append(itemsContainer);var continueShopping=$("<div>",{class:"cart-notification-button cart-notification-continue"}).text(data.continue_button).on("click",function(){dialogObject.dialog("close")});dialogObject.append(continueShopping);var goToCart=$("<a>",{href:getRootPath()+"/store/cart/shopping-cart.html",class:"cart-notification-button cart-notification-gotocart"}).text(data.go_to_cart_button+" ").append($("<i>",{class:"fa fa-caret-right","aria-hidden":"true"}));dialogObject.append(goToCart);dialogObject.dialog({draggable:!1,resizable:!1,modal:!0,open:function(event,ui){$('.ui-widget-overlay').bind('click',function(){dialogObject.dialog('close')})}});$(".ui-dialog-titlebar").hide()}
function clearItemForm(){$("#os0").val('');$(".js-related-checkbox:checked").each(function(){$(this).prop("checked",!1)})}
function clearFormAndNotify(items){showNotification(items);clearItemForm()}
function setAddToCartListener(){checkIfDiscontinuedOrUnavailableItem();checkIfComingSoon();$("#add_to_cart").on("click",function(){if(!formValidated()){alert("Please fill out your car make for better service");return}
var item=getItemFromPage();addItemToCart(item);var relatedItems=getRelatedItemsFromPage();relatedItems.forEach(function(relatedItem){addItemToCart(relatedItem)});var addedItems=relatedItems;addedItems.unshift(item);clearFormAndNotify(addedItems);updateCartIndicator()})}
function setAddRelatedItemListener(){$(".js-related-checkbox").on("change",function(){var amount=parseFloat($("#item-amount").val());$(".js-related-checkbox:checked").each(function(){amount+=parseFloat($(this).closest(".js-related-item").find(".js-related-amount").val())});$("#cart_total").text(amount.toFixed(2))})}
function lookupShipping(index,amount){var priceTab=shippingTable[index].rates;var lowerBound=0.0;var shipping=0;for(var i in priceTab)
if(Math.round(amount)>=Math.round(i)&&Math.round(i)>=Math.round(lowerBound)){lowerBound=i;shipping=priceTab[i]}
return shipping}
function checkFirstShippingOption(){$(".js-shipping-radio:first").trigger("click")}
function checkSelectedOrFirstShippingOption(){var cart=getCart();if(cart.shipping!==undefined&&cart.shipping.id){$("#"+cart.shipping.id).attr("checked",!0)}else{$(".js-shipping-radio:first").attr("checked",!0)}}
function getShippingOptions(cart,country){country=(country)?country:"US";var amount=calculateCartTotalAmount(cart.items);var isCartBackordered=!isCartContainsBackorderedItems(cart);var options=[];for(var i=0;i<shippingTable.length;i++){if(shippingTable[i].countries.indexOf(country)>=0||(shippingTable[i].countries==='*'&&shippingTable[i].except_countries.indexOf(country)===-1)){var shippingAmount=lookupShipping(i,amount);if(shippingAmount!==0){var option={name:shippingTable[i].title,amount:shippingAmount,time:shippingTable[i].max_days,id:i+"_sh_opt",service:shippingTable[i],showDateRange:isCartBackordered};options.push(option)}}}
return options}
function showShippingOptions(cart){var addressCountry=getShippingAddress()["address_country"];var shippingOptions=getShippingOptions(cart,addressCountry);$("#shipping-options").html("");for(var i=0;i<shippingOptions.length;i++){addShippingOption(shippingOptions[i])}
checkFirstShippingOption()}
function getPSTTime(date){var offset=-8;var strDate=new Date(date.getTime()+offset*3600*1000).toUTCString().replace(/ GMT$/,"");return new Date(strDate)}
function getShippingTime(date,serviceSchedule,deliveryTime){var schedule=[];for(var holiday in holidays){if(serviceSchedule.Holidays[holiday]===!1){schedule.push(new Date(holidays[holiday]))}}
while(deliveryTime>0){var day=date.getDay();var skipDay=!1;if(((serviceSchedule.Weekends.Saturday===!1)&&day===6)||((serviceSchedule.Weekends.Sunday===!1)&&day===0)){skipDay=!0}
for(var i=0;i<schedule.length;i++){var holidayDate=schedule[i];if(holidayDate.getYear()===date.getYear()&&holidayDate.getMonth()===date.getMonth()&&holidayDate.getDate()===date.getDate()){skipDay=!0}}
if(skipDay===!1){deliveryTime--}
date=date.addDays(1)}
return getDeliveryDate(date,serviceSchedule)}
function getDeliveryDate(date,serviceSchedule){var day=date.getDay();var schedule=[];for(var holiday in holidays){if(serviceSchedule.Holidays[holiday]===!1){schedule.push(new Date(holidays[holiday]))}}
if(((serviceSchedule.Weekends.Saturday===!1)&&day===6)||((serviceSchedule.Weekends.Sunday===!1)&&day===0)){date.setHours(0,0,0,0);date=getDeliveryDate(date.addDays(1),serviceSchedule)}
for(var i=0;i<schedule.length;i++){var holidayDate=schedule[i];if(holidayDate.getYear()===date.getYear()&&holidayDate.getMonth()===date.getMonth()&&holidayDate.getDate()===date.getDate()){date.setHours(0,0,0,0);date=getDeliveryDate(date.addDays(1),serviceSchedule);break}}
return date}
function getDispatchDate(date,serviceSchedule){var day=date.getDay();var schedule=[];for(var holiday in holidays){if(warehouseSchedule.Holidays[holiday]===!1||serviceSchedule.Holidays[holiday]===!1){schedule.push(new Date(holidays[holiday]))}}
if(((warehouseSchedule.Weekends.Saturday===!1||serviceSchedule.Weekends.Saturday===!1)&&day===6)||((warehouseSchedule.Weekends.Sunday===!1||serviceSchedule.Weekends.Sunday===!1)&&day===0)){date.setHours(0,0,0,0);date=getDispatchDate(date.addDays(1),serviceSchedule)}
for(var i=0;i<schedule.length;i++){var holidayDate=schedule[i];if(holidayDate.getYear()===date.getYear()&&holidayDate.getMonth()===date.getMonth()&&holidayDate.getDate()===date.getDate()){date.setHours(0,0,0,0);date=getDispatchDate(date.addDays(1),serviceSchedule);break}}
if(date.getHours()>=14){date.setHours(0,0,0,0);date=date.addDays(1)}
return date}
function calculateCartTotalAmount(items){var amountAndDiscount=calculateAmountAndDiscount(items);return amountAndDiscount.amount-amountAndDiscount.discount}
function calculateAmountAndDiscount(items){var amount=0;var discount=0;items.forEach(function(item){amount+=parseFloat(item.amount)*parseInt(item.quantity);discount+=getItemDiscount(item)});return{amount:amount,discount:discount}}
function calculateOrderTotal(cart){var itemsAmount=calculateCartTotalAmount(cart.items);return itemsAmount+parseFloat((cart.shipping!==undefined)?cart.shipping.amount:0)}
function getShippingAmountString(shippingAmount){shippingAmount=parseFloat(shippingAmount);return shippingAmount===0?"FREE":"$"+shippingAmount.toFixed(2)}
function formatDate(date,format){format=(format)?format:"default";var result="";switch(format){case "default":result=date.getDayName()+" "+date.getMonthName()+" "+date.getDate();break;case "short":result=date.getMonthName()+" "+date.getDate();break;default:result=date.getDayName()+" "+date.getMonthName()+" "+date.getDate();break}
return result}
function getShippingDateRange(option){var serviceSchedule=option.service.schedule;var dispatchDate=getDispatchDate(getPSTTime(new Date()),serviceSchedule);dispatchDate=dispatchDate.addDays(option.service.handling);var stDate=getShippingTime(dispatchDate,serviceSchedule,option.service.min_days);var enDate=stDate;var deliveryTime=formatDate(stDate);if(option.service.max_days!==option.service.min_days){enDate=getShippingTime(dispatchDate,serviceSchedule,option.service.max_days);deliveryTime+=" - "+formatDate(enDate)}
return{string:deliveryTime,dateRange:{from:stDate,to:enDate}}}
function getShippingDaysRange(option){var deliveryTime="";if(option.service.min_days===option.service.max_days){if(option.service.min_days===1){deliveryTime="1 business day"}else{deliveryTime=option.service.min_days+" business days"}}else{deliveryTime=option.service.min_days+"-"+option.service.max_days+" business days"}
return deliveryTime}
function formShippingTimeString(option){var deliveryTime="";if(option.showDateRange){deliveryTime=getShippingDateRange(option).string}else{deliveryTime=getShippingDaysRange(option)}
return deliveryTime}
function addShippingOption(option){option.amount=option.amount===-1?0:option.amount;var shippingAmountString=" ("+getShippingAmountString(option.amount)+")";var deliveryTime=formShippingTimeString(option);var $container=$('<div>',{class:"js-shipping-option"}).append($('<div>',{class:"w-4"}).append($("<input>",{type:"radio",name:"shipping",value:option.amount,class:"js-shipping-radio",id:option.id,"data-option-name":option.name,"data-option-time":deliveryTime})));var $description=$('<div>',{class:"w-96"}).append($('<label>',{class:"shipping-label",for:option.id}).text(option.name+shippingAmountString)).append($('<span>').text(deliveryTime));$container.append($description);$("#shipping-options").append($container)}
function updateShippingPage(){var cart=getCart();var shippingAmount=parseFloat($(".js-shipping-radio:checked").val());shippingAmount=isNaN(shippingAmount)?0:shippingAmount;var amountAndDiscount=calculateAmountAndDiscount(cart.items);var shippingAddress=getShippingAddress();var tax=getActualTax(shippingAddress,amountAndDiscount.amount-amountAndDiscount.discount,cart);var total=shippingAmount+amountAndDiscount.amount-amountAndDiscount.discount+tax;var discount=amountAndDiscount.discount;$("#total_cart").text(amountAndDiscount.amount.toFixed(2));$("#discount_amount").text(discount.toFixed(2));$("#total_amount").text(total.toFixed(2));$("#shipping_amount").text(getShippingAmountString(shippingAmount));$("#tax_amount").text(tax.toFixed(2));if(discount<=0){$("#coupon-row").remove()}
var $taxName=$("#tax-name");var $canadaText=$("#canada-option");if(shippingAddress!==null&&shippingAddress.hasOwnProperty("address_country")&&shippingAddress.address_country==="CA"){$taxName.text("GST/HST");$canadaText.show()}else{$taxName.text("Tax");$canadaText.hide()}}
function updateShipping(option){var cart=getCart();cart.shipping=option;updateCart(cart)}
function extractShippingData($selectedOption){var amount=$selectedOption.val();var id=$selectedOption.attr("id");var name=$selectedOption.data("option-name");var time=$selectedOption.data("option-time");return{name:name,amount:amount,id:id,time:time}}
function updateOrderShipping($this){var shippingData=extractShippingData($this);updateShipping(shippingData);updateShippingPage()}
function setShippingOptionListener(){$("#shipping-options").on("change",".js-shipping-radio",function(){var $this=$(this);updateOrderShipping($this)})}
function setCard(card){localStorage.setItem("card",JSON.stringify(card))}
function getCard(){return JSON.parse(localStorage.getItem("card"))}
function detectCardType(number){var re={electron:/^(4026|417500|4405|4508|4844|4913|4917)\d+$/,maestro:/^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/,dankort:/^(5019)\d+$/,interpayment:/^(636)\d+$/,unionpay:/^(62|88)\d+$/,visa:/^4[0-9]{12}(?:[0-9]{3})?$/,mastercard:/^5[1-5][0-9]{14}$/,amex:/^3[47][0-9]{13}$/,diners:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,discover:/^6(?:011|5[0-9]{2})[0-9]{12}$/,jcb:/^(?:2131|1800|35\d{3})\d{11}$/};for(var key in re){if(re[key].test(number)){return key}}}
function setOptionsSubmitListener(){$("#credit-submit").on("click",function(e){var $form=$("#card-data");if($form[0].checkValidity()){e.preventDefault();var cardExp=$("#card_exp").val().split("/");var card={ccnum:$("#card_number").val(),month:cardExp[0],year:cardExp[1],cvv2:$("#card_cvv").val()};setCard(card);window.location.href="order-review.html"}})}
function setPaymentValidationListener(){var $cardExp=$("#card_exp");var $cardNum=$("#card_number");$cardExp.on("cut copy paste",function(e){e.preventDefault()});$cardExp.on("keypress",function(e){preventNotNumeric(e);var val=$cardExp.val();if(String.fromCharCode(e.which)==="/"){if(val.length===1){$cardExp.val("0"+val+"/")}}
val=val.replace("/","");if(val.length>=2){$cardExp.val(val.substr(0,2)+"/"+val.substr(2))}});$cardNum.on("keypress",function(e){preventNotNumeric(e)});function preventNotNumeric(e){var char=String.fromCharCode(e.which);if(!$.isNumeric(char)){e.preventDefault()}}}
function restoreCardData(){var card=getCard();var $cardNumber=$("#card_number");var $cardExp=$("#card_exp");if(card!==undefined&&card!==null&&$cardNumber.length>0&&$cardExp.length>0){$cardNumber.val(card.ccnum);$cardExp.val(card.month+"/"+card.year)}}
function updateShippingOptions(){var cart=getCart();setShippingOptionListener();showShippingOptions(cart)}
function setPaymentMethodListener(){$(".js-payment-method").on("change",function(e){var $this=$(this);var targetId=$this.data("wrapper");$(".js-method-wrapper").slideUp();$(targetId).slideDown()});$("#paypal-submit").on("click",function(e){e.preventDefault();payWithPaypal()});setAmazonLogin();renderAmazonButton("medium")}
function initShippingOptions(){if($("#credit_review").length>0){updateShippingOptions();setOptionsSubmitListener();setPaymentValidationListener();setPaymentMethodListener();setChatIcon();updateOrderShipping($(".js-shipping-radio:checked"));restoreCardData()}}
function initShippingOptionsAmazon(){if($("#amazon_confirm").length>0){setOptionsSubmitListener();setChatIcon();updateOrderShipping($(".js-shipping-radio:checked"));restoreCardData()}}
function renderAmazonAddressWidget(){var orderID;new OffAmazonPayments.Widgets.AddressBook({sellerId:'A30AAU8MWXVBP1',onOrderReferenceCreate:function(orderReference){orderID=orderReference.getAmazonOrderReferenceId();$("#amazon-order").val(orderID)},onAddressSelect:function(orderReference){$.ajax({url:getRootPath()+'/cart/common/mws_proxy.php?setShippingAddress',type:'POST',headers:{"cache-control":"no-cache"},data:'order='+$("#amazon-order").val(),dataType:'json',contentType:'application/x-www-form-urlencoded; charset=UTF-8',success:function(response){setSerializedAddressData(response.address);updateShippingOptions()},error:function(xhr){alert("An error occured: "+xhr.status+" "+xhr.statusText)}})},design:{designMode:'responsive'},onError:function(error){}}).bind("addressBookWidgetDiv")}
function renderAmazonWalletWidget(){new OffAmazonPayments.Widgets.Wallet({sellerId:'A30AAU8MWXVBP1',onPaymentSelect:function(orderReference){},design:{designMode:'responsive'},onError:function(error){alert(error.getErrorCode()+'\n'+error.getErrorMessage())}}).bind("walletWidgetDiv")}
function destroySession(){var deferred=$.Deferred();$.get(getRootPath()+"/cart/cart.php?destroy_session").done(function(){deferred.resolve()});return deferred}
function clearSessionData(){localStorage.clear();destroySession()}
function confirmPayment(cart){cart.payment="success";updateCart(cart)}
function confirmAmazonOrder(){var cart=getCart();var amountAndDiscount=calculateAmountAndDiscount(cart.items);$("#amazon-amount").val(amountAndDiscount.amount.toFixed(2));$("#amazon-discount").val(amountAndDiscount.discount.toFixed(2));$("#amazon-shipping").val(cart.shipping.amount);$("#amazon-carrier").val(cart.shipping.name);$("#amazon-tax").val(getActualTax(getShippingAddress(),amountAndDiscount.amount-amountAndDiscount.discount,cart).toFixed(2));var data=$("#amazon").serialize();$.ajax({url:getRootPath()+'/cart/common/mws_proxy.php?confirm',type:'POST',data:data,dataType:"text",success:function(response){if(response.trim()==="OK"){confirmPayment(cart);window.location.href="thankyou.html"}else{alert("Fail!")}},error:function(xhr){alert("An error occured: "+xhr.status+" "+xhr.statusText)}})}
function setAmazonConfirmListener(){$("#amazon").on("submit",function(e){e.preventDefault();var cart=getCart();postCart(cart).done(function(){setSessionOption("","");confirmAmazonOrder()})})}
function initAmazonConfirmation(){if($("#amazon_confirm").length>0){setAmazonLogin();renderAmazonAddressWidget();renderAmazonWalletWidget();setAmazonConfirmListener()}}
function checkIfDiscontinuedOrUnavailableItem(){var isDiscontinued=$("#item-discontinued").val()==="yes";var isUnavailable=$("#item-unavailable").val()==="yes";if(isDiscontinued){$("#add_to_cart").val("Discontinued").attr("disabled","disabled").addClass("add_to_cart__disabled")}else if(isUnavailable){$("#add_to_cart").val("Unavailable").attr("disabled","disabled").addClass("add_to_cart__disabled")}}
function checkIfComingSoon(){var isComingSoon=$("#item-coming_soon").val()==="yes";if(isComingSoon){$("#add_to_cart").val("Coming soon").attr("disabled","disabled").addClass("add_to_cart__disabled");var $title=$("<div>",{class:"col-md-12 cart-notification-title"}).text("Coming soon!");var $dialogObject=$("<div>",{class:"cart-notification-object"}).append($title).append($("<div>",{style:"text-align: center;"}).append($("<a>").html("VLine Infotainment system for your vehicle is coming soon!")).append("<br>").append("<br>").append($("<a>",{href:"#emailAddr",style:"color: #337ab7;"}).text("Sign up for pre-order alert >").on("click",function(e){$dialogObject.dialog("close")})));$dialogObject.dialog({draggable:!1,resizable:!1,modal:!0,closeOnEscape:!0,open:function(event,ui){$('.ui-widget-overlay').bind('click',function(){$dialogObject.dialog('close')})}});$(".ui-dialog-titlebar").hide()}}
function setPageItemListener(){setAddToCartListener();setAddRelatedItemListener()}
function formAddress(info){return $.grep([info.address_street,info.address_street2,info.address_city,info.address_state,info.address_zip],Boolean).join(", ")}
function formName(info){return $.grep([info.first_name,info.last_name],Boolean).join(" ")}
function setBillingInfoToPage(){var billingInfo=getBillingAddress();if(!$.isEmptyObject(billingInfo)){$("#bill_name").text(formName(billingInfo));$("#bill_address").text(formAddress(billingInfo))}else{$("#bill-to").remove()}}
function setShippingInfoToPage(){var shippingInfo=getShippingAddress();if(!$.isEmptyObject(shippingInfo)){$("#ship_name").text(formName(shippingInfo));$("#ship_address").text(formAddress(shippingInfo));$("#ship_phone").text("P: "+shippingInfo.phone);$("#ship_email").text(shippingInfo.payer_email)}else{}}
function setOrderInfoToPage(){var cart=getCart();var amountAndDiscount=calculateAmountAndDiscount(cart.items);var tax=getActualTax(getShippingAddress(),amountAndDiscount.amount-amountAndDiscount.discount,cart);$(".js-review-total-amount").text("$"+(calculateOrderTotal(cart)+tax).toFixed(2));if(cart.shipping!==undefined){$("#shipping_title").text(cart.shipping.name);$("#shipping_amount").text(getShippingAmountString(cart.shipping.amount));$("#shipping_delivery_time").text(cart.shipping.time)}
$("#subtotal_amount").text("$"+calculateCartTotalAmount(cart.items).toFixed(2));$("#tax_amount").text(tax.toFixed(2))}
function setCustomerInfoToPage(){setBillingInfoToPage();setShippingInfoToPage();setOrderInfoToPage();initThankPage()}
function showCartItems(){var cart=getCart();var $container=$("#cart-review-container");cart.items.forEach(function(item){var $item=$('<div>',{class:"border-bottom"});var $image=setImage(item,2);var $description=setItemDescription(item,6);var $quantity=$("<div>",{class:"col-sm-2 col-xxs-offset-4 cart_qty text-right-res m-10"}).append($("<span>",{class:"review-quantity"}).text(item.quantity));var $amount=$("<div>",{class:"col-sm-2 col-xxs-offset-4 cart_amount text-right-res m-10"}).append(getItemAmountAndDiscount(item));var $clearfix=$("<div>",{class:"clearfix"});$item.append($image);$item.append($description);$item.append($quantity);$item.append($amount);$item.append($clearfix);$container.append($item)})}
function showPaymentData(){var card=getCard();if(card!==null){var type=detectCardType(card.ccnum);var name,image;switch(type){case "electron":case "visa":image="visa.png";name="Visa";break;case "mastercard":image="master.png";name="MasterCard";break;case "discover":image="discover.png";name="Discover";break;case "amex":image="american.png";name="American Express";break;default:type=undefined}
if(type!==undefined){var $paymentImg=$("#payment-img");$paymentImg.attr("src",$paymentImg.data("src")+image);$("#card-exp").text(card.month+"/"+card.year);$("#card-name").text(name);$("#card-number").text(card.ccnum.replace(/.(?=.{4})/g,'#'))}}}
function setPlaceOrderListener(){$(".js-cart-place_order").on("click",function(e){var $button=$(this);e.preventDefault();if(!$button.prop("disabled")){$button.prop("disabled",!0);postCart(getCart()).done(function(){setSessionOption("","");placeOrder()}).always(function(){$button.prop("disabled",!1)})}})}
function initOrderReview(){if($("#shopping_review").length>0){getSessionAddress().done(function(addressData){setAddressData(addressData);setCustomerInfoToPage()}).fail(function(){setCustomerInfoToPage()});showCartItems();setChatIcon();showPaymentData();setPlaceOrderListener()}}
function getUrlParameterByName(name,url){if(!url)url=window.location.href;name=name.replace(/[\[\]]/g,"\\$&");var regex=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)"),results=regex.exec(url);if(!results)return null;if(!results[2])return'';return decodeURIComponent(results[2].replace(/\+/g," "))}
function isPaymentConfirmed(cart){return cart.payment==="success"||getUrlParameterByName("payment")==="success"}
function initRecommendedCarousel(){$("#owl-demo").owlCarousel({autoPlay:3000,navigation:!0,navigationText:!1,pagination:!1,stopOnHover:!0,items:3,itemsDesktop:[1199,3],itemsDesktopSmall:[979,2]})}
function initThankPage(){if($("#thank_page").length>0){initRecommendedCarousel();var cart=getCart();$("#order_id").text(cart.orderID);if(isPaymentConfirmed(cart)){reportReferrer(cart.orderID).done(function(){clearSessionData()})}}}
function initPaypalCreditCheckout(){if($("#paypal-credit-container").length===0)
return;var mode=(sandboxMode)?"sandbox":"production";paypal.Button.render({env:mode,funding:{allowed:[paypal.FUNDING.CREDIT],disallowed:[]},style:{label:'credit',size:'responsive',shape:'rect',tagline:'false',},client:{sandbox:'Ad1IQem3Lf55NxBDSbjmlOI_N0v8qz-t-aD8DrCHniHo4144MTaPXHPlZtBo5-4h6b677BRSzQZQQ3uF',production:'Af-OrJUSQ03h6gbvHWAFmNm2Swvdn__RZWRMTd3k9iCwUSdzfKBi7cpGIlLmG6RXjHQorvqQ2_gXf774'},payment:function(data,actions){var cart=getCart();postCart(cart);setSessionOption("pc",1);var total=calculateCartTotalAmount(cart.items).toFixed(2);var itemList={items:[]};$.each(cart.items,function(index,elem){itemList.items.push({"name":elem.name,"quantity":elem.quantity,"price":elem.amount,"sku":elem.number,"currency":"USD"});if(elem.hasOwnProperty("discount")){itemList.items.push({"name":elem.name+" ("+cart.coupon+")","quantity":elem.quantity,"price":-elem.discount,"sku":cart.coupon,"currency":"USD"})}});var url=window.location.href;var str=url.substr(url.lastIndexOf('/')+1)+'$';url=url.replace(new RegExp(str),'')+"thankyou_pp.html?payment=success";return actions.payment.create({payment:{"transactions":[{"amount":{"total":total,"currency":"USD",},"custom":cart.orderID,"invoice_number":cart.orderID,"item_list":itemList}],"redirect_urls":{"return_url":url,}}})},onAuthorize:function(data,actions){return actions.payment.execute().then(function(){actions.redirect()})},onError:function(error){return alert(error)}},'#paypal-credit-container')}
function setSessionOption(option,value){$.get(getRootPath()+"/cart/cart.php",{set_option:"",option:option,value:value})}
$(document).ready(function(){sandboxMode=window.location.hostname!=="gromaudio.com";initShoppingCart();initCheckoutPage();initShippingOptions();initShippingOptionsAmazon();initAmazonConfirmation();updateCartIndicator();setPageItemListener();initOrderReview();initPaypalCreditCheckout();setLeavePageListener();clearSessionIfPaymentComplete(getCart())})